# System Architecture & Data Flow

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    F1 Race Strategy System                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Raw Race      â”‚         â”‚   HPC Compute   â”‚         â”‚   Enrichment    â”‚
â”‚   Telemetry     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Cluster       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Module        â”‚
â”‚                 â”‚         â”‚                 â”‚         â”‚  (port 8000)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                  â”‚
                                                                  â”‚ POST webhook
                                                                  â”‚ (enriched data)
                                                                  â”‚
                                                                  â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚     AI Intelligence Layer (port 9000)       â”‚
                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                            â”‚  â”‚  Step 1: Strategy Brainstorming      â”‚   â”‚
                            â”‚  â”‚  - Generate 20 diverse strategies    â”‚   â”‚
                            â”‚  â”‚  - Temperature: 0.9 (creative)       â”‚   â”‚
                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                            â”‚                    â”‚                        â”‚
                            â”‚                    â–¼                        â”‚
                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                            â”‚  â”‚  Step 2: Strategy Analysis           â”‚   â”‚
                            â”‚  â”‚  - Select top 3 strategies           â”‚   â”‚
                            â”‚  â”‚  - Temperature: 0.3 (analytical)     â”‚   â”‚
                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                            â”‚                                             â”‚
                            â”‚  Powered by: Google Gemini 1.5 Pro          â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ Strategic recommendations
                                               â”‚
                                               â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚      Race Engineers / Frontend          â”‚
                            â”‚  - Win probabilities                    â”‚
                            â”‚  - Risk assessments                     â”‚
                            â”‚  - Engineer briefs                      â”‚
                            â”‚  - Driver radio scripts                 â”‚
                            â”‚  - ECU commands                         â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow - Detailed

```
1. ENRICHED TELEMETRY INPUT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                                                               â”‚
â”‚   "lap": 27,                                                    â”‚
â”‚   "aero_efficiency": 0.83,        // 0-1, higher = better      â”‚
â”‚   "tire_degradation_index": 0.65, // 0-1, higher = worse       â”‚
â”‚   "ers_charge": 0.72,             // 0-1, energy available     â”‚
â”‚   "fuel_optimization_score": 0.91,// 0-1, efficiency           â”‚
â”‚   "driver_consistency": 0.89,     // 0-1, lap-to-lap variance  â”‚
â”‚   "weather_impact": "medium"      // low/medium/high           â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
2. RACE CONTEXT INPUT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                                                               â”‚
â”‚   "race_info": {                                                â”‚
â”‚     "track_name": "Monaco",                                     â”‚
â”‚     "current_lap": 27,                                          â”‚
â”‚     "total_laps": 58                                            â”‚
â”‚   },                                                            â”‚
â”‚   "driver_state": {                                             â”‚
â”‚     "driver_name": "Hamilton",                                  â”‚
â”‚     "current_position": 4,                                      â”‚
â”‚     "current_tire_compound": "medium",                          â”‚
â”‚     "tire_age_laps": 14                                         â”‚
â”‚   },                                                            â”‚
â”‚   "competitors": [...]                                          â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
3. TELEMETRY ANALYSIS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Calculate tire degradation rate: 0.030/lap                    â”‚
â”‚ â€¢ Project tire cliff: Lap 33                                    â”‚
â”‚ â€¢ Analyze ERS pattern: stable                                   â”‚
â”‚ â€¢ Assess fuel situation: OK                                     â”‚
â”‚ â€¢ Evaluate driver form: excellent                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
4. STEP 1: BRAINSTORM (Gemini AI)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Temperature: 0.9 (high creativity)                              â”‚
â”‚ Prompt includes:                                                â”‚
â”‚   â€¢ Last 10 laps telemetry                                      â”‚
â”‚   â€¢ Calculated trends                                           â”‚
â”‚   â€¢ Race constraints                                            â”‚
â”‚   â€¢ Competitor analysis                                         â”‚
â”‚                                                                 â”‚
â”‚ Output: 20 diverse strategies                                   â”‚
â”‚   â€¢ Conservative (1-stop, low risk)                             â”‚
â”‚   â€¢ Standard (balanced approach)                                â”‚
â”‚   â€¢ Aggressive (undercut/overcut)                               â”‚
â”‚   â€¢ Reactive (respond to competitors)                           â”‚
â”‚   â€¢ Contingency (safety car, rain)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
5. STRATEGY VALIDATION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Pit laps within valid range                                   â”‚
â”‚ â€¢ At least 2 tire compounds (F1 rule)                           â”‚
â”‚ â€¢ Stop count matches pit laps                                   â”‚
â”‚ â€¢ Tire sequence correct length                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
6. STEP 2: ANALYZE (Gemini AI)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Temperature: 0.3 (analytical consistency)                       â”‚
â”‚ Analysis framework:                                             â”‚
â”‚   1. Tire degradation projection                                â”‚
â”‚   2. Aero efficiency impact                                     â”‚
â”‚   3. Fuel management                                            â”‚
â”‚   4. Driver consistency                                         â”‚
â”‚   5. Weather & track position                                   â”‚
â”‚   6. Competitor analysis                                        â”‚
â”‚                                                                 â”‚
â”‚ Selection criteria:                                             â”‚
â”‚   â€¢ Rank 1: RECOMMENDED (highest podium %)                      â”‚
â”‚   â€¢ Rank 2: ALTERNATIVE (viable backup)                         â”‚
â”‚   â€¢ Rank 3: CONSERVATIVE (safest)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
7. FINAL OUTPUT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ For EACH of top 3 strategies:                                   â”‚
â”‚                                                                 â”‚
â”‚ â€¢ Predicted Outcome                                             â”‚
â”‚   - Finish position: P3                                         â”‚
â”‚   - P1 probability: 8%                                          â”‚
â”‚   - P2 probability: 22%                                         â”‚
â”‚   - P3 probability: 45%                                         â”‚
â”‚   - Confidence: 78%                                             â”‚
â”‚                                                                 â”‚
â”‚ â€¢ Risk Assessment                                               â”‚
â”‚   - Risk level: medium                                          â”‚
â”‚   - Key risks: ["Pit under 2.5s", "Traffic"]                   â”‚
â”‚   - Success factors: ["Tire advantage", "Window open"]          â”‚
â”‚                                                                 â”‚
â”‚ â€¢ Telemetry Insights                                            â”‚
â”‚   - "Tire cliff at lap 35"                                      â”‚
â”‚   - "Aero 0.83 - performing well"                               â”‚
â”‚   - "Fuel excellent, no saving"                                 â”‚
â”‚   - "Driver form excellent"                                     â”‚
â”‚                                                                 â”‚
â”‚ â€¢ Engineer Brief                                                â”‚
â”‚   - Title: "Aggressive Undercut Lap 28"                         â”‚
â”‚   - Summary: "67% chance P3 or better"                          â”‚
â”‚   - Key points: [...]                                           â”‚
â”‚   - Execution steps: [...]                                      â”‚
â”‚                                                                 â”‚
â”‚ â€¢ Driver Audio Script                                           â”‚
â”‚   "Box this lap. Softs going on. Push mode."                    â”‚
â”‚                                                                 â”‚
â”‚ â€¢ ECU Commands                                                  â”‚
â”‚   - Fuel: RICH                                                  â”‚
â”‚   - ERS: AGGRESSIVE_DEPLOY                                      â”‚
â”‚   - Engine: PUSH                                                â”‚
â”‚                                                                 â”‚
â”‚ â€¢ Situational Context                                           â”‚
â”‚   - "Decision needed in 2 laps"                                 â”‚
â”‚   - "Tire deg accelerating"                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## API Endpoints Detail

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GET /api/health                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Purpose: Health check                                           â”‚
â”‚  Response: {status, version, demo_mode}                          â”‚
â”‚  Latency: <100ms                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/ingest/enriched                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Purpose: Webhook receiver from enrichment service               â”‚
â”‚  Input: Single lap enriched telemetry                            â”‚
â”‚  Action: Store in buffer (max 100 records)                       â”‚
â”‚  Response: {status, lap, buffer_size}                            â”‚
â”‚  Latency: <50ms                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/strategy/brainstorm                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Purpose: Generate 20 diverse strategies                         â”‚
â”‚  Input:                                                          â”‚
â”‚    - enriched_telemetry (optional, auto-fetch if missing)        â”‚
â”‚    - race_context (required)                                     â”‚
â”‚  Process:                                                        â”‚
â”‚    1. Fetch telemetry if needed                                  â”‚
â”‚    2. Build prompt with telemetry analysis                       â”‚
â”‚    3. Call Gemini (temp=0.9)                                     â”‚
â”‚    4. Parse & validate strategies                                â”‚
â”‚  Output: {strategies: [20 strategies]}                           â”‚
â”‚  Latency: <5s (target)                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/strategy/analyze                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Purpose: Analyze 20 strategies, select top 3                    â”‚
â”‚  Input:                                                          â”‚
â”‚    - enriched_telemetry (optional, auto-fetch if missing)        â”‚
â”‚    - race_context (required)                                     â”‚
â”‚    - strategies (required, typically 20)                         â”‚
â”‚  Process:                                                        â”‚
â”‚    1. Fetch telemetry if needed                                  â”‚
â”‚    2. Build analytical prompt                                    â”‚
â”‚    3. Call Gemini (temp=0.3)                                     â”‚
â”‚    4. Parse nested response structures                           â”‚
â”‚  Output:                                                         â”‚
â”‚    - top_strategies: [3 detailed strategies]                     â”‚
â”‚    - situational_context: {...}                                  â”‚
â”‚  Latency: <10s (target)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Integration Patterns

### Pattern 1: Pull Model
```
Enrichment Service (8000)  â†â”€â”€â”€â”€â”€GET /enrichedâ”€â”€â”€â”€â”€  AI Layer (9000)
                                 [polls periodically]
```

### Pattern 2: Push Model (RECOMMENDED)
```
Enrichment Service (8000)  â”€â”€â”€â”€â”€POST /ingest/enrichedâ”€â”€â”€â”€â–¶  AI Layer (9000)
                                [webhook on new data]
```

### Pattern 3: Direct Request
```
Client  â”€â”€POST /brainstormâ”€â”€â–¶  AI Layer (9000)
        [includes telemetry]
```

## Error Handling Flow

```
Request
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validate Input  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     NO      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Telemetry       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Fetch from       â”‚
â”‚ Provided?       â”‚             â”‚ localhost:8000   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    YES  â”‚                               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Call Gemini  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                   â”‚ Success?â”‚
                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                   YES  â”‚  NO
                        â”‚   â”‚
                        â”‚   â–¼
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  â”‚ Retry with     â”‚
                        â”‚  â”‚ stricter promptâ”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚           â”‚
                        â”‚      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                        â”‚      â”‚Success? â”‚
                        â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                        â”‚      YES  â”‚  NO
                        â”‚           â”‚   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
                                    â”‚   â–¼
                                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  â”‚ Return     â”‚
                                    â”‚  â”‚ Error 500  â”‚
                                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ Return       â”‚
                            â”‚ Success 200  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Performance Characteristics

| Component | Target | Typical | Max |
|-----------|--------|---------|-----|
| Health check | <100ms | 50ms | 200ms |
| Webhook ingest | <50ms | 20ms | 100ms |
| Brainstorm (20 strategies) | <5s | 3-4s | 10s |
| Analyze (top 3) | <10s | 6-8s | 20s |
| Gemini API call | <3s | 2s | 8s |
| Telemetry fetch | <500ms | 200ms | 1s |

## Scalability Considerations

- **Concurrent Requests**: FastAPI async handles multiple simultaneously
- **Rate Limiting**: Gemini API has quotas (check your tier)
- **Caching**: Demo mode caches identical requests
- **Buffer Size**: Webhook buffer limited to 100 records
- **Memory**: ~100MB per service instance

---

Built for the HPC + AI Race Strategy Hackathon ğŸï¸
